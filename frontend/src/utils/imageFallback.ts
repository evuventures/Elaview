// utils/imageFallback.ts

// Data URI for a simple gray placeholder image
export const FALLBACK_IMAGE_LARGE = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2Y1ZjVmNSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPk5vIEltYWdlIEF2YWlsYWJsZTwvdGV4dD4KPC9zdmc+';

export const FALLBACK_IMAGE_MEDIUM = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y1ZjVmNSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4=';

export const FALLBACK_IMAGE_SMALL = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y1ZjVmNSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4=';

// Function to handle image errors
export const handleImageError = (
  e: React.SyntheticEvent<HTMLImageElement, Event>,
  size: 'large' | 'medium' | 'small' = 'medium'
) => {
  const target = e.target as HTMLImageElement;
  
  // Prevent infinite loop by checking if we've already set a fallback
  if (target.dataset.fallbackSet === 'true') {
    return;
  }
  
  target.dataset.fallbackSet = 'true';
  
  switch (size) {
    case 'large':
      target.src = FALLBACK_IMAGE_LARGE;
      break;
    case 'small':
      target.src = FALLBACK_IMAGE_SMALL;
      break;
    default:
      target.src = FALLBACK_IMAGE_MEDIUM;
  }
};

// Function to get the appropriate fallback image
export const getFallbackImage = (size: 'large' | 'medium' | 'small' = 'medium'): string => {
  switch (size) {
    case 'large':
      return FALLBACK_IMAGE_LARGE;
    case 'small':
      return FALLBACK_IMAGE_SMALL;
    default:
      return FALLBACK_IMAGE_MEDIUM;
  }
};